# tic documentation: https://docs.ropensci.org/tic/dev/

# Download script file from GitHub
init:
  ps: |
    $ErrorActionPreference = "Stop"
    Invoke-WebRequest http://raw.github.com/krlmlr/r-appveyor/master/scripts/appveyor-tool.ps1 -OutFile "..\appveyor-tool.ps1"
    Import-Module '..\appveyor-tool.ps1'

install:
  - ps: Bootstrap
  - cmd: Rscript -e "writeLines('options(repos = \'https://cloud.r-project.org\')', '~/.Rprofile')"
  - cmd: Rscript -e "getOption('repos')"
  - cmd: Rscript -e "if (!requireNamespace('remotes')) install.packages('remotes', type = 'binary')"
  - cmd: Rscript -e "if (getRversion() < '3.2' && !requireNamespace('curl')) install.packages('curl', type = 'binary')"
  - cmd: Rscript -e "options(pkgType = 'binary'); remotes::install_github('ropensci/tic@do-drat', upgrade = 'always'); print(tic::dsl_load()); tic::prepare_all_stages()"

before_build: Rscript -e "tic::before_install()"
build_script: Rscript -e "tic::install()"
after_build: Rscript -e "tic::after_install()"
before_test: Rscript -e "tic::before_script()"
test_script: Rscript -e "tic::script()"
on_success: Rscript -e "try(tic::after_success(), silent = TRUE)"
on_failure: Rscript -e "tic::after_failure()"
before_deploy: Rscript -e "tic::before_deploy()"
deploy_script: Rscript -e "tic::deploy()"
after_deploy: Rscript -e "tic::after_deploy()"
on_finish: Rscript -e "tic::after_script()"

# no testing on R-devel because no package binaries are available
environment:
  matrix:
    - R_VERSION: release
    - R_VERSION: oldrel
  id_rsa:
    secure: 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
  USE_RTOOLS: true

matrix:
  fast_finish: true
# Custom user code -------------------------------------------------------------
